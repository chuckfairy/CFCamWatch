;(function() {"use strict";var CF=CF||{};CF.Watch={REVISION:1},CF.Watch.Dispatcher=function(){},CF.Watch.Dispatcher.prototype={constructor:CF.Watch.Dispatcher,apply:function(n){return n.on=CF.Watch.Dispatcher.prototype.on,n.hasListener=CF.Watch.Dispatcher.prototype.hasListener,n.removeListener=CF.Watch.Dispatcher.prototype.removeListener,n.dispatch=CF.Watch.Dispatcher.prototype.dispatch,n},on:function(n,t){void 0===this._listeners&&(this._listeners={});var e=this._listeners;void 0===e[n]&&(e[n]=[]),-1===e[n].indexOf(t)&&e[n].push(t)},hasListener:function(n,t){if(void 0===this._listeners)return!1;var e=this._listeners;return void 0!==e[n]&&-1!==e[n].indexOf(t)?!0:!1},removeListener:function(n,t){if(void 0!==this._listeners){var e=this._listeners,i=e[n];if(void 0!==i){var o=i.indexOf(t);-1!==o&&i.splice(o,1)}}},dispatch:function(n){if(void 0!==this._listeners){var t=this._listeners,e=t[n.type];if(void 0!==e){n.target=this;for(var i=[],o=e.length,s=0;o>s;s++)i[s]=e[s];for(var s=0;o>s;s++)i[s].call(this,n)}}}},CF.Watch.App=function(n){var t=this;t.Connection=new CF.Watch.Connection,t.UI=new CF.Watch.UI,t.images=[],t.cameras=[],t.init()},CF.Watch.App.prototype={constructor:CF.Watch.App,Connection:null,UI:null,images:[],init:function(){var n=this;n.setConnectionEvents(),n.setDomEvents()},setConnectionEvents:function(){var n=this;n.Connection.on("login",n.login.bind(n)),n.Connection.response("update",function(t){console.log("Cam update");var e=0|t.num;console.log("CAM NUM",e),n.images.push(t.base64),n.UI.update(e,t.base64)}),n.Connection.on("get-info",function(t){console.log("GET INFO",t),n.UI.setCameraViews(t.data.num)})},setDomEvents:function(){var n=this;n.UI.loginBtn.onclick=function(){var t=n.UI.getPassword();console.log(t),n.Connection.login(t)}},login:function(){var n=this;n.UI.hideLogin()}},CF.Watch.UI=function(){var n=this;n.imgArea=document.getElementById("img"),n.imgScreens=[],n.loginScreen=document.getElementById("login-screen"),n.passwordArea=document.getElementById("password"),n.loginBtn=document.getElementById("passsword-submit")},CF.Watch.UI.prototype={constructor:CF.Watch.UI,imgArea:null,imgScreens:null,loginScreen:null,passwordArea:null,loginBtn:null,update:function(n,t){var e=this,i=e.imgScreens[n];i.src=t},setCameraViews:function(n){function t(){var t=document.createElement("div");return t.className="row",t.style.height=s/(n/2)+"px",t}function e(n,t){var e=document.createElement("div");return e.className="col-xs-"+n+" col-flex",e.style.height=t,e}function i(){var n=document.createElement("img");return n.className="img-fullscreen",n}var o=this,s=window.innerHeight;if(n>0)for(var c=null,r=0;n>r;r++){var a=c;r%2&&a||(a=t(n));var l=e(6,a.style.height),h=i();l.appendChild(h),a.appendChild(l),o.imgArea.appendChild(a),o.imgScreens.push(h),c=a}else{var h=i();o.imgArea.appendChild(h),o.imgScreens.push(h)}},hideLogin:function(){this.loginScreen.style.display="none"},getPassword:function(){return this.passwordArea.value}},CF.Watch.Connection=function(n,t){var e=this;e.app=n,e.init()},CF.Watch.Connection.prototype={io:window.io,loggedIn:!1,opts:{},socket:null,init:function(){var n=this;n.socket=n.io(),n.socket.on("login-info",n.setInfo.bind(n)),n.socket.on("login-success",n.setLogin.bind(n))},createDisplay:function(n){var t=this;return function(e){t.app.display(n,e)}},request:function(n,t){this.socket.emit(n,t)},response:function(n,t){this.socket.on(n,t)},setInfo:function(n){var t=this;n.logged&&t.setLogin(),console.log(n),t.dispatch({type:"get-info",data:n})},setLogin:function(){var n=this;n.loggedIn=!0,n.dispatch({type:"login"})},login:function(n){var t=this;t.socket.emit("login",{pass:n})}},CF.Watch.Dispatcher.prototype.apply(CF.Watch.Connection.prototype),window.onload=function(){new CF.Watch.App};})();